var app=function(){function n(n){var t=1;return"-"===n[0]&&(t=-1,n=n.substr(1)),function(a,e){var o=a[n]<e[n]?-1:a[n]>e[n]?1:0;return o*t}}var t={$container:$("#datatable"),$buttons:$("#xbuttons"),filepath:"/data/qlife_mtm.json",yvar:"pred",seriesvar:"blendid",nonplots:["blendid","corpid","datetime"]},a=[],e=[],o={},r=[],i=[],c=[],l=function(){d(),s(),p(),u()},d=function(){$("#help").click(function(){$("#infoModal").modal()})},s=function(){$(".dropdown-menu li a").click(function(){var n=$(this),a=n.parents(".dropdown").find(".btn");a.html(n.text()+' <span class="caret"></span>'),a.val(n.data("value")),t.filepath=n.attr("data-ref"),m()})},p=function(){$("#change-range").unbind(),$("#change-range").click(function(){c=b(t.$container.data())}),$("#reset-range").unbind(),$("#reset-range").click(function(){$("#ymin").val(e[0]),$("#ymax").val(e[1]),$("#change-range").click()}),$(".hide-at-start").css("display","none")},u=function(){$("#export").unbind(),$("#export").click(function(){Highcharts.exportCharts(c)})},h=function(n,t){var a=1/0,e=-(1/0);return $.each(n,function(n,o){value=o[t],value<a?a=value:value>e&&(e=value)}),[a,e]},v=function(n){var a={};return $.each(n,function(n,e){$.each(Object.keys(e),function(n,o){o!==t.yvar&&(Object.keys(a).indexOf(o)<0&&(a[o]=[]),a[o].indexOf(e[o])<0&&a[o].push(e[o]))})}),a},f=function(n){var a=$.map(n,function(n){return n}).sort();$.each(a,function(a,e){var o="";e===n.plot&&(o=" active"),void 0!==e&&t.$buttons.append($("<label/>",{"class":"btn btn-primary"+o,id:"label-"+e}).append($("<input/>",{type:"radio",id:"btn-"+e,"data-xname":e})).append("Plot "+e))})},m=function(){$(".hide-at-start").css("display",""),$.ajax({url:t.filepath,dataType:"json",async:!0}).done(function(n){a=n,e=h(n,t.yvar),$("#ymin").val(e[0]),$("#ymax").val(e[1]),o=v(n),r=$.grep(Object.keys(o),function(n){return-1===t.nonplots.indexOf(n)}),i=$.grep(r,function(n){return r[0]!==n});var l={row:i[1],col:i[0],plot:r[0]};c=b(l)})},b=function(n){return t.$container.html(""),t.$buttons.html(""),t.$container.data(n),c=void 0===n.row?g(n):void 0===n.col?y(n):w(n),f(n),x(n),c},x=function(n){var a=$.map(n,function(n){return n});$('label[id^="label-"]').on("click",function(){var n=$(this)[0].firstChild,t=n.dataset.xname,e=$.grep(a,function(n){return t!==n}),o={row:e[0],col:e[1],plot:t};c=b(o)}),$("#swap").unbind(),$("#swap").click(function(){var n={row:t.$container.data("col"),col:t.$container.data("row"),plot:t.$container.data("plot")};return c=b(n),!1})},w=function(n){c=[];var a=o[n.col],e=o[n.row],r=$("<div/>",{"class":"flex-row"});return r.append($("<div/>",{"class":"chart-holder row-header"})),a.map(function(t){r.append($("<div/>",{"class":"chart-holder"}).html("<h4>"+n.col+" : "+t+"</h4>"))}),t.$container.append(r),e.map(function(e){var o=$("<div/>",{"class":"flex-row"});o.append($("<div/>",{"class":"row-header"}).html("<h4>"+n.row+" : "+e+"</h4>")),a.map(function(t){var a=[n.row,e,n.col,t].join("");o.append($("<div/>",{id:"plot-"+a,"class":"chart-holder"}))}),t.$container.append(o)}),e.map(function(t){a.map(function(a){var e=k(n,t,a);c.push(e)})}),c.numRows=e.length,c.numCols=a.length,c},g=function(n){c=[];var a=o[n.col];return $headerFlexbox=$("<div/>",{"class":"flex-row"}),$row=$("<div/>",{"class":"flex-row"}),a.map(function(t){var a=[n.col,t].join("");$headerFlexbox.append($("<div/>",{"class":"column-header"}).html("<h4>"+n.col+" : "+t+"</h4>")),$row.append($("<div/>",{id:"plot-"+a,"class":"chart-holder"}))}),t.$container.append($headerFlexbox),t.$container.append($row),a.map(function(t){var a=k(n,void 0,t);c.push(a)}),c.numRows=1,c.numCols=a.length,c},y=function(n){c=[];var a=o[n.row],e=$("<div/>",{"class":"flex-column"}),r=$("<div/>",{"class":"flex-column"});return a.map(function(t){var a=[n.row,t].join("");e.append($("<div/>",{"class":"row-header"}).html("<h4>"+n.row+" : "+t+"</h4>")),r.append($("<div/>",{id:"plot-"+a,"class":"chart-holder-column"}))}),t.$container.append(e),t.$container.append(r),a.map(function(t){var a=k(n,t,void 0);c.push(a)}),c.numRows=a.length,c.numCols=1,c},k=function(a,e,r){var i=j(a,e,r),c="plot-"+[a.row,e,a.col,r].join(""),l=$("#ymin").val(),d=$("#ymax").val(),s="";s=void 0===a.row?a.col+" = "+r:void 0===a.col?a.row+" = "+e:a.row+" = "+e+", "+a.col+" = "+r;var p={exporting:{chartOptions:{chart:{margin:void 0},title:{text:s},xAxis:{title:{text:a.plot}}},sourceHeight:400},chart:{renderTo:c,type:"spline",backgroundColor:null,borderWidth:0,margin:[2,0,2,0],height:200,width:void 0,style:{overflow:"visible"}},title:{text:""},credits:{enabled:!1},xAxis:{title:{text:""}},yAxis:{min:l,max:d,title:{text:""},labels:{reserveSpace:!0},opposite:!0},legend:{enabled:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.75)",borderColor:"rgba(0, 0, 0, 0.8)",borderRadius:20,borderWidth:1,shadow:!1,useHTML:!0,hideDelay:0,shared:!0,padding:0,positioner:function(n,t,a){return{x:a.plotX-n/2,y:a.plotY-t}},formatter:function(){var t="<h4>"+a.plot+": "+this.x+'</h4><table class="table table-condensed" id="tooltip-table"><tr><th>Blend ID</th><th>Prediction</th></tr>',e=this.points.sort(n("-y"));return $.each(e,function(n,a){t+='<tr><td style="color: '+a.series.color+'"><b>'+a.series.name+"</b></td><td>"+a.y+"</td></tr>"}),t+="</table>"}},plotOptions:{series:{animation:!1,lineWidth:2,shadow:!1,states:{hover:{lineWidth:2}},marker:{radius:3,states:{hover:{radius:4}}},fillOpacity:.25}},series:[]};o[t.seriesvar].map(function(n){p.series.push({name:n,data:[]})}),$.each(i,function(n,e){var o={x:e[a.plot],y:e[t.yvar]};$.each(p.series,function(n,a){e[t.seriesvar]===a.name&&a.data.push(o)})});var u=new Highcharts.chart(p,function(){var n=$("#legend");""===n.html()&&$.each(this.series,function(t,a){var e=$("<div/>",{"class":"media"}),o=$("<div/>",{"class":"media-left"}),r=$("<div/>",{"class":"media-body"}),i=$("<div/>",{"class":"media-object"}).css({"background-color":a.color,width:"32px",height:"32px"}),c=$("<h4/>",{"class":"media-heading"}).text(a.name);o.append(i),r.append(c),e.append(o),e.append(r),n.append(e)})});return u},j=function(n,t,e){var o=[];return $.each(a,function(a,r){void 0===n.row?r[n.col]===e&&o.push(r):void 0===n.col?r[n.row]===t&&o.push(r):r[n.row]===t&&r[n.col]===e&&o.push(r)}),o};return{init:l}}();$(function(){app.init()});
